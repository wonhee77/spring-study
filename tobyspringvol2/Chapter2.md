# 2장 데이터 엑세스 기술

## 2.1 공통 개념  

### DAO 패턴
데이터 액세스 계층은 DAO 패턴이라 불리는 방식응로 분리하는 것이 원칙이다. DAO 패턴은 DTO 또는 도메인 오브젝트만을 사용하는 인터페이스를 통해 데이터 액세스 기술을  
외부에 노출시키지 않도록 만드는 것이다. DAO 인터페이스는 기술과 상관없는 단순한 DTO나 도메인 모델만을 사용하기 때문에 언제든지 목오브젝트 같은 테스트 대역  
오브젝트로 대체해서 단위 테스트를 작성할 수 있다.

DAO 인터페이스와 DI  
DAO는 인터페이스를 이용해 접근하고 DI되도록 만들어야 한다. DAO 인터페이스에는 구체적인 데이터 엑세스 기술과 관련된 어떤 API나 정보도 노출하지 않는다.  
인터페이스를 만들 때 습관적으로 DAO 클래스의 모든 public 메소드를 추가하지 않도록 주의하자. DAO를 사용하는 서비스 계층에서 의미 있는 메소드만 인터페이스로  
공개해야 된다. 

예외처리  
데이터 엑세스 중에 발생하는 예외는 대부분 복구할 수 없다. 따라서 DAO 밖으로 던져질 때는 런타임 예외여야 한다. throws로 외부로 노출하지 말고 DAO 내부에서 발생하는  
예외는 모두 런타임 예외로 전환해야 한다.

#### 템플릿과 API
스프링은 DI의 응용 패턴인 템플릿/콜백 패턴을 통해 이런 판에 박힌 코드를 피하고 꼭 필요한 바뀌는 내용만 담을 수 있도록 데이터 엑세스 기술을 위한 템플릿을 제공한다.  

#### DataSource
JDBC를 통해 DB를 사용하려면 Connection 타입의 DB 연결 오브젝트가 필요하다. 매번 요청마다 Connection을 새롭게 만들면 비효율적이고 성능을 떨어뜨린다.  
그래서 보통 미리 정해진 개수만큼의 DB 커넥션을 풀에 준비해두고, 애플리케이션이 요청할 때마다 풀에서 꺼내 하나씩 할당해주고 다시 돌려받아서 풀에 넣는 식의 폴링 기법을  
이용한다.  
스프링에서는 DataSource를 하나의 독립된 빈으로 등록하도록 강력하게 권장한다. 

학습 테스트와 통합 테스트를 위한 DataSource  
- SimpleDriverDataSource  
스프링이 제공하는 가장 단순한 DataSource 구현 클래스다. getConnection()을 호출할 때마다 매번 DB 커넥션을 새로 만들고 따로 풀을 관리하지 않는다. 실전에서는  
  사용하면 안된다.
  

- SingleConnectionDataSource  
하나의 물리적인 DB 커넥션만 만들어두고 이를 계속 사용하는 DataSource다. 동시에 두 개 이상의 스레드가 동작하는 경우에는 하나의 커넥션을 공유하게 되므로 위험하다.  
  
오플소스 또는 상용 DB 커넥션 풀  
오픈소스로 개발된 DB 커넥션 풀도 많이 사용된다.

- 아파치 Commons DBCP  
가장 유명한 오픈소스 DB 커넥션 풀 라이브러리다.
  
- c3p0 JDBC/DataSource Resource Pool


JDNI/WAS DB 풀  
대부분의 자바 서버는 자체적으로 DB 풀 서비스를 제공해준다.

